---
## Front matter
lang: ru-RU
title: Лабораторная работа №7
subtitle: Управление журналами событий в системе
author:
  - Ко А.Г.
institute:
  - Российский университет дружбы народов, Москва, Россия
date: 18 февраля 2025

## i18n babel
babel-lang: russian
babel-otherlangs: english

## Formatting pdf
toc: false
toc-title: Содержание
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
---

# Информация

## Докладчик

:::::::::::::: {.columns align=center}
::: {.column width="70%"}

  * Ко Антон Геннадьевич
  * Студент
  * Российский университет дружбы народов
  * [1132221551@pfur.ru](mailto:1132221551@pfur.ru)
  * <https://github.com/SenDerMen04>

:::
::::::::::::::

## Цель работы
Целью данной работы является получение навыков работы с журналами мониторинга различных событий в системе.

## Выполнение работы

### Мониторинг журнала системных событий в реальном времени

Для начала запустим три вкладки терминала и в каждом из них получим полномочия администратора:

```bash
su -
```

На второй вкладке терминала запустим мониторинг системных событий в реальном времени:

```bash
tail -f /var/log/messages
```

#### В третьей вкладке терминала:
1. Вернёмся к учётной записи своего пользователя:

```bash
Ctrl + d
```

2. Попробуем получить полномочия администратора, но при этом вводим неправильный пароль.

Во второй вкладке терминала с мониторингом событий появится сообщение:

```
FAILED SU (to root) agko on pts/2
```

Отображаемые на экране сообщения также фиксируются в файле:

```bash
/var/log/messages
```

Далее, в третьей вкладке терминала введём:

```bash
logger hello
```

Затем возвращаемся во вторую вкладку терминала с мониторингом событий и видим сообщение, которое также будет зафиксировано в файле:

```bash
/var/log/messages
```

Чтобы остановить трассировку файла сообщений мониторинга реального времени, используем:

```bash
Ctrl + c
```

Запустим мониторинг сообщений безопасности (последние 20 строк соответствующего файла логов):

```bash
tail -n 20 /var/log/secure
```

Мы видим сообщения, которые ранее были зафиксированы во время ошибки авторизации при вводе команды `su -`.

### Изменение правил rsyslog.conf

В первой вкладке терминала установим Apache:

```bash
dnf -y install httpd
```

После окончания процесса установки запустим веб-службу:

```bash
systemctl start httpd
systemctl enable httpd
```

Во второй вкладке терминала посмотрим журнал сообщений об ошибках веб-службы:

```bash
tail -f /var/log/httpd/error_log
```

Чтобы закрыть трассировку файла журнала, используем:

```bash
Ctrl + c
```

В третьей вкладке терминала получим полномочия администратора и в файле конфигурации `/etc/httpd/conf/httpd.conf` в конце добавляем строку:

```
ErrorLog syslog:local1
```

Затем создаём файл мониторинга событий веб-службы:

```bash
cd /etc/rsyslog.d

touch httpd.conf
```

Открываем его на редактирование и прописываем:

```
local1.* - /var/log/httpd-error.log
```

Перезагружаем конфигурацию rsyslogd и веб-службу:

```bash
systemctl restart rsyslog.service
systemctl restart httpd
```

### Создание файла конфигурации для мониторинга отладочной информации

```bash
cd /etc/rsyslog.d

touch debug.conf

echo "*.debug /var/log/messages-debug" > /etc/rsyslog.d/debug.conf
```

Перезапускаем rsyslogd:

```bash
systemctl restart rsyslog.service
```

Запускаем мониторинг отладочной информации:

```bash
tail -f /var/log/messages-debug
```

В третьей вкладке терминала введём:

```bash
logger -p daemon.debug "Daemon Debug Message"
```

Чтобы закрыть трассировку файла журнала, используем:

```bash
Ctrl + c
```

### Использование journalctl

Смотрим содержимое журнала с событиями с момента последнего запуска системы:

```bash
journalctl
```

Просмотр журнала без использования пейджера:

```bash
journalctl --no-pager
```

Режим просмотра журнала в реальном времени:

```bash
journalctl -f
```

Прерывание просмотра:

```bash
Ctrl + c
```

Просмотр событий для UID 0:

```bash
journalctl _UID=0
```

Отображение последних 20 строк журнала:

```bash
journalctl -n 20
```

Просмотр только сообщений об ошибках:

```bash
journalctl -p err
```

Просмотр сообщений с ошибками со вчерашнего дня:

```bash
journalctl --since yesterday -p err
```

Просмотр дополнительной информации о модуле sshd:

```bash
journalctl _SYSTEMD_UNIT=sshd.service
```

### Постоянный журнал journald

```bash
su -
mkdir -p /var/log/journal
chown root:systemd-journal /var/log/journal
chmod 2755 /var/log/journal
killall -USR1 systemd-journald
journalctl -b
```

## Ответы на контрольные вопросы:

1. **Какой файл используется для настройки rsyslogd?**  
   `/etc/rsyslog.conf`

2. **В каком файле журнала rsyslogd содержатся сообщения, связанные с аутентификацией?**  
   `/var/log/secure`

3. **Сколько времени потребуется для ротации файлов журналов по умолчанию?**  
   *Неделя*

4. **Как записать все сообщения с приоритетом info в файл /var/log/messages.info?**  
   `info.* - /var/log/messages.info`

5. **Какая команда позволяет видеть сообщения журнала в режиме реального времени?**  
   `tail -f /var/log/messages`

6. **Какая команда позволяет видеть все сообщения журнала для PID 1 между 9:00 и 15:00?**  
   `journalctl _PID=1 --since "2022-02-01 09:00:00" --until "2022-02-01 15:00:00"`

7. **Какая команда позволяет видеть сообщения journald после последней перезагрузки системы?**  
   `journalctl -b`

## Вывод
В ходе выполнения лабораторной работы были получены навыки работы с журналами мониторинга различных событий в системе.


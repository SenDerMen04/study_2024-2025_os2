---
## Front matter
lang: ru-RU
title: Лабораторная работа №8
subtitle: Планировщики событий
author:
  - Ко А.Г.
institute:
  - Российский университет дружбы народов, Москва, Россия
date: 18 февраля 2025

## i18n babel
babel-lang: russian
babel-otherlangs: english

## Formatting pdf
toc: false
toc-title: Содержание
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
---

# Информация

## Докладчик

:::::::::::::: {.columns align=center}
::: {.column width="70%"}

  * Ко Антон Геннадьевич
  * Студент
  * Российский университет дружбы народов
  * [1132221551@pfur.ru](mailto:1132221551@pfur.ru)
  * <https://github.com/SenDerMen04>

:::
::::::::::::::

## Цель работы:
Целью данной работы является получение навыков работы с планировщиками событий cron и at.

---

## Планирование задач с помощью cron:

### Мониторинг журнала системных событий в реальном времени:
Запустим терминал и получим полномочия администратора:
```bash
su -
```
Просмотрим статус демона crond и содержимое файла конфигурации:
```bash
systemctl status crond -l
cat /etc/crontab
```

_Рис. 1. Запуск терминала и получение полномочий администратора, просмотр статуса демона crond и содержимого файла конфигурации /etc/crontab._

Теперь просмотрим список заданий в расписании:
```bash
crontab -l
```
Ничего не отобразилось, так как расписание ещё не задано. Далее откроем файл расписания на редактирование:
```bash
crontab -e
```
_Рис. 3. Просмотр списка заданий в расписании, открытие файла расписания на редактирование._

Предыдущая команда запустила интерфейс редактора (по умолчанию используется vi). Добавим следующую строку в файл расписания (запись сообщения в системный журнал):
```bash
*/1 * * * * logger This message is written from root cron
```
Закроем сеанс редактирования vi и сохраним изменения:
```bash
Esc :wq
```

_Рис. 4. Открытие текстового редактора vi и добавление строки в файл расписания._

Просмотрим список заданий в расписании:
```bash
crontab -l
```
Не выключая систему, через некоторое время (2–3 минуты) просмотрим журнал системных событий:
```bash
grep written /var/log/messages
```
_Рис. 5. Просмотр списка заданий в расписании, просмотр журнала системных событий._

Вернёмся в текстовый редактор vi и изменим запись в расписании crontab на следующую:
```bash
0 */1 * * 1-5 logger This message is written from root cron
```
_Рис. 6. Изменение записи в расписании crontab._

Теперь просмотрим список заданий в расписании:
```bash
crontab -l
```
_Рис. 7. Просмотр списка заданий в расписании._

Перейдём в каталог /etc/cron.hourly и создадим в нём файл сценария с именем eachhour:
```bash
cd /etc/cron.hourly
touch eachhour
```
Далее откроем файл eachhour для редактирования и пропишем в нём следующий скрипт:
```bash
#!/bin/sh
logger This message is written at $(date)
```
_Рис. 9. Открытие файла eachhour для редактирования и прописывание в нём скрипта._

Сделаем файл сценария eachhour исполняемым:
```bash
chmod +x eachhour
```
Теперь перейдём в каталог /etc/crond.d и создадим в нём файл с расписанием eachhour:
```bash
cd /etc/cron.d
touch eachhour
```
Откроем этот файл для редактирования и поместим в него следующее содержимое:
```bash
11 * * * * root logger This message is written from /etc/cron.d
```
Сохраним изменения.

_Рис. 11. Добавление содержимого в файл и сохранение изменений._

Не выключая систему, через некоторое время (час) просмотрим журнал системных событий:
```bash
grep written /var/log/messages
```
_Рис. 12. Просмотр журнала системных событий через час._

---

## Планирование заданий с помощью at:
Запустим терминал и получим полномочия администратора:
```bash
su -
```
Проверим, что служба atd загружена и включена:
```bash
systemctl status atd
```
Зададим выполнение команды в 9:30:
```bash
at 9:30
logger message from at
Ctrl + D
```
Убедимся, что задание действительно запланировано:
```bash
atq
```
Проверим лог-файл:
```bash
grep from at /var/log/messages
```

_Рис. 14. Создание задачи выполнения команды logger message from at в 9:30, закрытие оболочки. Проверка планировки задачи и выполнения её в указанное время._

---

## Ответы на контрольные вопросы:
1. `00 00 1,15 * * logger task`
2. `00 02 1,15 * * logger task`
3. `*/2 * * * * logger task`
4. `* * 19 9 * logger task`
5. `* * * * 4 logger task`
6. `* * * * alice logger task`
7. Добавить пользователя в `/etc/cron.deny`
8. Найти задание в логах:
   ```bash
grep cron /var/log/messages
```
9. Проверить запланированные задания:
   ```bash
atq
```

---

## Вывод:
В ходе выполнения лабораторной работы были получены навыки работы с планировщиками событий cron и at.
